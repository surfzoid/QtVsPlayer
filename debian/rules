#!/usr/bin/make -f
export QT_SELECT := qt5
export DH_VERBOSE=1
# This is the debhelper compatability version to use.

#export DH_COMPAT=3
DESTDIR=$(CURDIR)/debian/project
TR_DIR=$(CURDIR)/debian/project/usr/share/QtVsPlayer/translations/
DEB_HOST_MULTIARCH ?= $(shell dpkg-architecture -qDEB_HOST_MULTIARCH)
HOST_ARCH=$(shell uname -m)
CONFIGURE_EXTRA_FLAGS += --libdir=\$${prefix}/lib/$(DEB_HOST_MULTIARCH)
BUILDDIR=$(CURDIR)
PKGBUILDDIR=$(CURDIR)

configure:
	#dh_auto_configure -- $(CONFIGURE_EXTRA_FLAGS)
	qmake QtVsPlayer.pro
	wget https://github.com/surfzoid/QtVsPlayer/raw/main/lib/$(HOST_ARCH)/libPlayCtrl.so -o lib/$(HOST_ARCH)/libPlayCtrl.so
	wget https://github.com/surfzoid/QtVsPlayer/raw/main/lib/$(HOST_ARCH)/libSuperRender.so -o lib/$(HOST_ARCH)/libSuperRender.so
	wget https://github.com/surfzoid/QtVsPlayer/raw/main/lib/$(HOST_ARCH)/libAudioRender.so -o lib/$(HOST_ARCH)/libAudioRender.so

clean:
	dh_testdir
	dh_testroot
	dh_clean

build:  configure
	dh_testdir
	lrelease QtVsPlayer_fr_FR.ts
	$(MAKE)

install: build
	mkdir -p $(TR_DIR)
	cp QtVsPlayer_fr_FR.qm $(TR_DIR)
	$(MAKE) INSTALL_ROOT=usr/share install
	dh_installdirs

binary: build install
	 dh_testdir
	 dh_testroot
	 dh_installmenu
	 dh_link
	 dh_strip
	 dh_compress
	 dh_fixperms
	 dh_installdeb
	 dh_shlibdeps
	 dh_gencontrol
	 dh_md5sums
	 dh_builddeb

shlibdeps:dh_shlibdeps -l$(shell pwd)/lib/$(HOST_ARCH)
